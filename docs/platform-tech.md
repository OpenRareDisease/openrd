# 5. 平台与技术实现

本章在既有架构与需求文档基础上，补全平台选型、分层架构、核心功能与质量保障的技术实现说明，便于落地执行与评审对齐。

---

## 5.1 平台选型与理由（可组合）

### 5.1.1 代码与协作（GitHub）

- **用途**：源代码托管、PR 审核、版本标签、CI/CD。
- **理由**：现有工作流已围绕 PR 审核与标签版本展开，符合多人协作与可追溯性要求；GitHub Actions 与仓库结构天然集成。
- **落地**：`main` 仅通过 PR 合入；使用 `feature/*`、`fix/*`、`release/*`；发布前跑全量测试与冒烟；标签记录里程碑。

### 5.1.2 知识与文档（GitBook / Notion，建议）

- **用途**：对外知识库（患者/医生）、对内协作与运营手册。
- **理由**：
  - GitBook 适合对外发布的结构化知识（版本化、可公开、搜索友好）。
  - Notion 适合内部协同与任务管理（轻量编辑、模板化、表格/看板）。
- **与仓库衔接**：文档可从 `docs/` 定期导入或镜像；对外版需经过医学审核流程。

### 5.1.3 社区与讨论（Discourse / Discord / 微信群，建议）

- **用途**：患者互助、经验分享、运营活动、线上支持。
- **理由**：
  - Discourse 适合结构化社区与内容沉淀（标签、分区、检索）。
  - Discord 适合实时互动与志愿者/医生协作。
  - 微信群覆盖国内用户、触达成本低。
- **与产品衔接**：社区服务可与 Discourse/Discord 做账号或内容同步；微信群仅做运营入口，不做长期知识沉淀。

> 注：以上为可落地的推荐组合；具体是否采用由产品与合规团队定稿。

---

## 5.2 架构图与分层说明

### 5.2.1 总体架构（已有技术架构）

- **客户端**：React Native（iOS/Android）+ 响应式 Web
- **网关**：API Gateway（鉴权、限流、路由、版本管理）
- **微服务**：用户、档案、问答、社区、试验、资源等
- **数据存储**：PostgreSQL（结构化数据）、Redis（缓存/会话）、MinIO/S3（文件）

### 5.2.2 面向业务的四层视角

> 用于对齐“内容层 / 协作层 / 传播层 / 数据层”的业务表达，与技术架构一一映射。

1. **内容层**
   - 知识库（FSHD 专业知识、临床路径、康复内容）
   - 社区内容（帖子、评论、视频）
   - 医疗内容（患者档案、报告、量表）

2. **协作层**
   - 角色与权限体系（患者/医生/研究者）
   - 内容审核与医学审校
   - PRD/运营/医学专家协作流程（可由 Notion/内网协作平台承载）

3. **传播层**
   - App 内社区分发
   - 官网/知识库外部传播
   - 运营活动（微信群/Discord/公众号等触达）

4. **数据层**
   - 结构化数据库（患者档案、试验信息）
   - 文档与多媒体存储（报告、影像、视频）
   - 搜索与索引（全文检索）
   - 审计与安全日志

---

## 5.3 核心功能实现

### 5.3.1 内容发布与版本管理

- **社区内容发布**：社区服务支持帖子发布、评论、点赞；发布后进入审核队列。
- **知识内容发布**：专业知识库内容需医学专家审核后发布；AI 问答对接知识库进行检索。
- **版本管理**：
  - 代码层面：PR 审核、标签版本、发布流程。
  - 内容层面：建议采用 GitBook/Notion 的版本历史与回滚能力；对外发布需走审核流程。

### 5.3.2 检索与标签体系

- **全文检索**：数据层包含搜索引擎，用于知识库、社区内容、试验信息的全文检索。
- **AI 问答检索**：通过 Node API 调用知识服务，向量检索由本地 embedding 生成并查询 Chroma Cloud。
- **标签体系（建议）**：
  - 主题标签：疾病分型、症状、康复、用药、心理等。
  - 人群标签：患者/家属/医生/研究者。
  - 内容类型标签：指南/经验/视频/问答。
  - 标签需在发布/审核流程中强制标注，方便检索与推荐。

### 5.3.3 权限与安全

- **认证**：手机号 + 密码 / 第三方登录；JWT Access Token + Refresh Token。
- **授权**：
  - RBAC：患者、医生、研究者等角色权限集。
  - ABAC：基于资源所有权的细粒度权限（用户仅可访问本人档案）。
- **数据安全**：
  - 传输层 TLS 1.3、存储层 AES-256、敏感字段加密。
  - 访问审计与区块链存证（授权、访问、捐赠记录）。
  - 合规：HIPAA / GDPR / 中国网络安全法。

### 5.3.4 自动化与运维

- **CI/CD**：GitHub Actions 进行测试、构建、镜像发布与部署。
- **定期备份**：
  - 数据库每日全量、每小时增量、跨区域备份。
  - 文件存储版本化与定期快照。
- **内容同步**：
  - 临床试验信息同步。
  - 医院 HIS 数据双向同步（按隐私设置授权）。
- **表单导入（建议）**：
  - Web/移动端表单作为主入口；
  - 研究数据可通过批量导入工具同步入库，需配合脱敏与权限校验。

### 5.3.5 数据管理

- **采集范围**：
  - 患者档案：基本信息、诊断阶段、基因信息、测量指标。
  - 医疗文档：影像/报告/血检等。
  - 行为与活动数据：活动日志、康复记录。
  - 社区与互动数据：帖子、评论、互动行为。
- **脱敏策略**：
  - 研究用数据必须匿名化处理，去除 PII。
  - 对外展示仅输出聚合统计结果。
- **存储与访问控制**：
  - 数据分级管理，敏感字段加密存储。
  - 访问需鉴权并记录审计日志。
  - 文档下载采用签名链接与时效控制（待实现）。

### 5.3.6 质量控制（Quality Assurance）

- **内容审核标准**：
  - 医学知识内容必须由医学专家审核；
  - 社区内容需进行违规检测与人工复核；
  - 试验信息需核验来源与入组条件。
- **医学声明模板（建议）**：
  - “本平台信息仅供参考，不构成医疗诊断与治疗建议。”
  - “如需个体化诊疗，请咨询专业医生。”
  - “平台内容基于公开资料与专家审核，但不保证完全适用于个人情况。”
- **技术质量保障**：
  - 单测、集成、端到端测试。
  - ESLint + Prettier + TypeScript 严格模式。
  - 依赖漏洞扫描与容器镜像扫描。

---

## 5.4 已实现功能概括（基于当前仓库）

> 以下为仓库代码与文档中已体现的能力或原型，便于评审对齐现状。

- **AI 问答链路**：Node API + Python 知识服务；支持检索问题生成、Chroma Cloud 向量检索、进度轮询接口与前端进度展示。
- **知识检索服务**：本地 embedding 生成 + 云端检索，提供基础 RAG 检索能力。
- **患者档案相关设计**：档案聚合 DTO、权限校验要求与审计策略已定义，接口形态在文档中明确。
- **移动端 UI 原型**：问答、病程管理、社区分享、数据捐赠、隐私设置、设置/关于我们等页面已有实现或静态原型。
- **隐私与授权文案**：隐私设置与数据捐赠页面含授权说明与脱敏提示文案。
- **协作与发布流程**：PR 审核、标签版本、发布检查清单与 lint-staged 钩子机制已落地。

---

## 5.5 待补充与确认

为保证方案可执行，建议进一步确认以下事项：

1. 是否确定采用 GitBook/Notion/Discourse/Discord/微信群的组合与职责边界。
2. 标签体系的强制字段与最小集合（用于检索与推荐）。
3. 医学声明模板的最终版本与合规审阅路径。
4. 表单导入/批量导入的具体格式、数据校验与脱敏规范。
